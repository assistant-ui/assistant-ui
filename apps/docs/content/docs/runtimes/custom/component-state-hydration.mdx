---
title: Component State Hydration and Replay
description: Deterministic lifecycle and state replay for component message parts using instanceId-scoped patches.
---

import { Stage1ComponentParity } from "@/components/examples/stage1-component-parity";

<Callout type="warning">
  Interactive component hydration/replay semantics are experimental and may
  change in future releases.
</Callout>

## Overview

Interactive assistant components can keep their own state over time.

This page covers how assistant-ui keeps that state stable when updates arrive
out of order during streaming.

## What this enables

- A status card that updates from `loading` to `ready` without flicker.
- A progress card that always shows the latest known value.
- A UI that does not jump backwards if an older update arrives late.

## When to use this

Use this pattern when your assistant returns component parts that update over
time (for example: progress, queue position, long-running tasks, live data).

For standard runtime setup, start with
[AI SDK v6 Runtime](/docs/runtimes/ai-sdk/v6).

## How it works

1. Each component instance has a stable `instanceId`.
2. Component state is stored under `metadata.unstable_state.components[instanceId]`.
3. Every state patch has a numeric `seq`.
4. assistant-ui only applies a patch when `incomingSeq > currentSeq`.

That last rule is what prevents stale updates from overwriting newer state.

## Interactive Demo

The demo below replays a fixture sequence:

1. mount component `card_1` (`seq=1`, `lifecycle=mounting`)
2. apply `seq=2` patch (`lifecycle=active`, append `state.summary`)
3. drop stale `seq=1` patch trying to set `lifecycle=complete`

<Stage1ComponentParity />

### What to look for in the demo

1. The card starts in `mounting`.
2. A newer update (`seq=2`) moves it to `active` and appends text.
3. An older update (`seq=1`) is rejected as stale.

If your product has streaming latency, this is the behavior that keeps UI state
trustworthy.

## Using with external runtimes

If you are mapping your own backend format into assistant-ui:

1. Include `instanceId` on every component part.
2. Store state under `components/<instanceId>/...`.
3. Include numeric `seq` with each patch batch.
4. Keep operations to `set` and `append-text` for `aui-state` `v1`.

See the bridge guide for compatibility boundaries and caveats:
[External Store Runtime](/docs/runtimes/custom/external-store).
